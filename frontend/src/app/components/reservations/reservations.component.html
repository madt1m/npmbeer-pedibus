<app-stop-element *ngIf="dummy_stop" class="dummy"
                  [dummy]="true"
                  [selected]="true"
                  [stop]="dummy_stop"></app-stop-element>

<div class="container">
    <mat-card class="children">
        <mat-card-title>
            Bambini
        </mat-card-title>
        <mat-card-content fxLayout="column" fxLayoutGap="16px">
            <div>
                Seleziona il bambino che vuoi prenotare
            </div>
            <mat-chip-list fxLayout="column" fxLayoutGap="8px" *ngIf="children && children.length !== 0">
                <mat-chip *ngFor="let child of children" [selected]="child === selectedChild" (click)="selectChild(child)">{{child}}</mat-chip>
            </mat-chip-list>
        </mat-card-content>
    </mat-card>

    <div class="main">
        <mat-card>
            <mat-card-title>
                Prenotazione
            </mat-card-title>
            <mat-card-content>
                <div fxLayout="column">
                    <div fxlayout="row" class="row">
                        <mat-form-field class="element">
                            <mat-label>Seleziona una linea</mat-label>
                            <mat-select [(value)]="selectedLine" (valueChange)="updateData()">
                                <mat-option *ngFor="let line of lines" [value]="line">{{line.lineName}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="element">
                            <mat-label>Direzione</mat-label>
                            <mat-select [(value)]="selectedDirection" (valueChange)="updateData()">
                                <mat-option value="outward">Scuola</mat-option>
                                <mat-option value="back">Casa</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div fxlayout="row">
                        <mat-form-field class="element">
                            <input matInput [matDatepickerFilter]="allowedDaysFilter" [matDatepicker]="picker"
                                   placeholder="Seleziona una data" [formControl]="selectedDate"
                                   (dateChange)="updateData()">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker [touchUi]="isMobile" #picker></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div #tabs *ngIf="selectedLine">
                    <mat-divider></mat-divider>
                    <div>
                        Clicca su una fermata per selezionarla
                    </div>
                    <mat-divider></mat-divider>
                    <mat-tab-group dynamicHeight class="tabs" (resized)="onResize($event)" mat-stretch-tabs [(selectedIndex)]="selectedRun">
                        <div>
                            <mat-tab *ngFor="let run of selectedLine.outward; let i = index" label="Andata {{i+1}}">
                                <div class="stops">
                                    <app-stop-list  (window:resize)="onResize($event)" *ngIf="stop_rows && selected_stop; else spinner"
                                                   [selected_stop]="selected_stop"
                                                   [stops]="stop_rows[i]"></app-stop-list>
                                </div>

                            </mat-tab>
                            <mat-tab *ngFor="let run of selectedLine.back; let i = index" label="Ritorno {{i+1}}">
                                <div class="stops">
                                    <app-stop-list *ngIf="stop_rows && selected_stop; else spinner"
                                                   [selected_stop]="selected_stop"
                                                   [stops]="stop_rows[selectedLine.outward.length+i]"></app-stop-list>

                                </div>
                            </mat-tab>
                        </div>
                    </mat-tab-group>
                </div>
                <mat-card-footer>
                    Powered by NapalmBeer Inc. &copy;
                </mat-card-footer>
            </mat-card-content>
        </mat-card>
    </div>
</div>

<ng-template #spinner>
    <app-spinner></app-spinner>
</ng-template>
